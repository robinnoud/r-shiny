library(shiny)
library(leaflet)

# Simulated data_list (replace this with your actual data)
data_list <- data.frame(
  position.lat = runif(50, min = 48.5, max = 49.5),
  position.lng = runif(50, min = 2.2, max = 2.5),
  address = sample(c("Sector1", "Sector2", "Sector3"), 50, replace = TRUE)
)

ui <- fluidPage(
  sidebarPanel(
    selectInput("sector", "Select Sector", choices = unique(data_list$address))
  ),
  mainPanel(
    leafletOutput("mymap"),
    p(),
    actionButton("recalc", "Valider")
  )
)

server <- function(input, output, session) {
  
  filteredPoints <- eventReactive(input$recalc, {
    filtered_data <- data_list[data_list$address == input$sector, ]
    cbind(filtered_data$position.lat, filtered_data$position.lng)
  }, ignoreNULL = FALSE)
  
  output$mymap <- renderLeaflet({
    leaflet() %>%
      addProviderTiles(providers$Stamen.TonerLite,
                       options = providerTileOptions(noWrap = TRUE)
      ) %>%
      addMarkers(data = filteredPoints())
  })
}

shinyApp(ui, server)
